package com.rainbowmobiles.suggest;

import java.util.Properties;

import javax.mail.Message;
import javax.mail.MessagingException;
import javax.mail.Session;
import javax.mail.Transport;
import javax.mail.internet.InternetAddress;
import javax.mail.internet.MimeMessage;

import android.app.Activity;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;

public class MainActivity extends Activity {

	EditText userName;
	EditText msg;
	EditText userPhoneNo;
	EditText date;
	EditText invoiceNo;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);

		setContentView(R.layout.activity_main);
		initWidgets();

		Button login = (Button) findViewById(R.id.BtnSubmit);
		login.setOnClickListener(new View.OnClickListener() {

			public void onClick(View arg0) {

				String inputUserName = userName.getText().toString();
				String inputPhoneNo = userPhoneNo.getText().toString();
				String inputDate = date.getText().toString();
				String inputInvoiceNo = invoiceNo.getText().toString();
				String inputIssueDetails = msg.getText().toString();

				Properties props = new Properties();
				props.put("mail.smtp.host", "smtp.gmail.com");
				props.put("mail.smtp.socketFactory.port", "465");
				props.put("mail.smtp.socketFactory.class",
						"javax.net.ssl.SSLSocketFactory");
				props.put("mail.smtp.auth", "true");
				props.put("mail.smtp.port", "465");
				Session session = Session.getDefaultInstance(props,
						new javax.mail.Authenticator() {
							protected javax.mail.PasswordAuthentication getPasswordAuthentication() {
								return new javax.mail.PasswordAuthentication(
										"boopathytcu@gmail.com", "boo03061988");
							}
						});

				try {
					Message message = new MimeMessage(session);
					//String userEmail = UserEmailFetcher.getEmail(getApplicationContext());
					message.setFrom(new InternetAddress("boopathytcu@gmail.com"));
					message.setRecipients(Message.RecipientType.TO,
							InternetAddress.parse("urnanjun@gmail.com"));
					
					StringBuilder emailSubject = new StringBuilder("Compliant - ");
					emailSubject.append("Name::"+inputUserName+", ");
					emailSubject.append("Phone No::"+inputPhoneNo+", ");
					emailSubject.append("Date::"+inputDate+", ");
					emailSubject.append("Invoice No::"+inputInvoiceNo);
					message.setSubject(emailSubject.toString());
					
					/*StringBuilder emailMessage = new StringBuilder("Compliant Details:");
					emailMessage.append("\n ");
					emailMessage.append("Name::"+inputUserName+"\n ");
					emailMessage.append("Phone No::"+inputPhoneNo+"\n ");
					emailMessage.append("Date::"+inputDate+"\n ");
					emailMessage.append("Invoice No::"+inputInvoiceNo+"\n ");
					emailMessage.append("Issue Summary::"+inputIssueDetails+"\n \n ");
					emailMessage.append("Thanks,"+"\n ");
					emailMessage.append("Issue Reported from AndroidApp");*/
					
					
					StringBuilder emailMessage = new StringBuilder("<html><body style=\"font-family:sans-serif Arial\">");
					emailMessage.append("<div style=\"font-weight:normal; font-size:100%\">");
		            emailMessage.append("Name::"+inputUserName+"<br/> ");
					emailMessage.append("Phone No::"+inputPhoneNo+"<br/> ");
					emailMessage.append("Date::"+inputDate+"<br/> ");
					emailMessage.append("Invoice No::"+inputInvoiceNo+"<br/> ");
					emailMessage.append("Issue Summary::"+inputIssueDetails+"<br/><br/><br/> ");
					emailMessage.append("</div>");
					emailMessage.append("<div style=\"font-weight:normal; font-size:75%\">");
		            emailMessage.append("Thanks,"+"<br/> ");
					emailMessage.append("Issue Reported from AndroidApp");
					emailMessage.append("</div>");
					emailMessage.append("</body></html>");
					message.setContent(emailMessage.toString(), "text/html; charset=utf-8");

					Transport.send(message);
				} catch (MessagingException e) {
					throw new RuntimeException(e);
				}
			}
		});
	}

	private void initWidgets() {
		userName = (EditText) findViewById(R.id.userName);
		msg = (EditText) findViewById(R.id.message);
		userPhoneNo = (EditText) findViewById(R.id.userPhNo);
		date = (EditText) findViewById(R.id.userDate);
		invoiceNo = (EditText) findViewById(R.id.userInvoiceNo);
	}
}
